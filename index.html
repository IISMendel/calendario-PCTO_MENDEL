<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>üìö Calendario PCTO 2025-2026 - Interactive Dashboard</title>
  <style>
    :root {
      --primary-color: #667eea;
      --secondary-color: #764ba2;
      --accent-color: #f093fb;
      --success-color: #4ecdc4;
      --warning-color: #feca57;
      --danger-color: #ff6b6b;
      --dark-color: #2c3e50;
      --light-color: #ecf0f1;
      --text-primary: #2c3e50;
      --text-secondary: #7f8c8d;
      --shadow-light: 0 2px 10px rgba(0,0,0,0.1);
      --shadow-medium: 0 8px 25px rgba(0,0,0,0.15);
      --shadow-heavy: 0 15px 35px rgba(0,0,0,0.2);
      --border-radius: 16px;
      --transition: all .25s cubic-bezier(.4, 0, .2, 1);
    }
    *, *::before, *::after { box-sizing: border-box; }
    html, body { margin:0; padding:0; width:100%; overflow-x:hidden; }
    body {
      font-family: 'Inter', 'Segoe UI', system-ui, -apple-system, sans-serif;
      background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%);
      min-height: 100vh; color: var(--text-primary);
    }
    .main-container { max-width: 1400px; margin:0 auto; padding:20px; }
    .dashboard-header { text-align:center; margin-bottom:32px; color:#fff; }
    .dashboard-title {
      font-size: 3rem; font-weight:800; margin:0 0 8px;
      background: linear-gradient(135deg, #FFD700 0%, #FFA500 100%);
      -webkit-background-clip:text; -webkit-text-fill-color:transparent; background-clip:text; color:#FFD700;
    }
    .dashboard-subtitle { font-size:1.1rem; opacity:.95; }

    .calendar-container {
      background: rgba(255,255,255,0.95);
      backdrop-filter: blur(8px);
      border-radius: 24px;
      box-shadow: var(--shadow-heavy);
      overflow: hidden;
    }
    .tabs-container { display:flex; flex-wrap:wrap; background: linear-gradient(135deg, var(--dark-color), #34495e); }
    .tab { flex:1; padding:16px; background:transparent; border:none; color:rgba(255,255,255,0.75);
      cursor:pointer; font-size:1rem; font-weight:700; letter-spacing:.08em; text-transform:uppercase; transition:var(--transition); }
    .tab:hover { color:#fff; background:rgba(255,255,255,0.1); }
    .tab.active { color:#fff; background:rgba(255,255,255,0.18); position:relative; }
    .tab.active::after { content:''; position:absolute; left:0; right:0; bottom:0; height:4px;
      background: linear-gradient(90deg, var(--accent-color), var(--success-color)); }

    .calendar-content { padding:24px; }
    .content-section { display:none; }
    .content-section.active { display:block; animation: fadeIn .4s ease; }

    /* Mensile */
    .month-header { display:flex; align-items:center; justify-content:space-between; gap:16px; margin-bottom:16px; flex-wrap:wrap; }
    .nav-buttons-group { display: flex; gap: 8px; align-items: center; }
    .nav-button { background: linear-gradient(135deg, var(--primary-color), var(--secondary-color)); color:#fff;
      width:44px; height:44px; border-radius:50%; border:none; font-size:1.2rem; display:flex; align-items:center; justify-content:center;
      box-shadow: var(--shadow-light); cursor:pointer; transition:var(--transition); }
    .nav-button:hover { transform:scale(1.06); box-shadow: var(--shadow-medium); }
    .current-period { font-size:1.6rem; font-weight:800; min-width:220px; text-align:center; color:var(--text-primary); }
    .month-grid { display:grid; grid-template-columns: repeat(7, 1fr); gap:2px; background:var(--light-color);
      border-radius: var(--border-radius); overflow:hidden; box-shadow: var(--shadow-light); }
    .month-day-header { background:var(--dark-color); color:#fff; padding:12px 8px; text-align:center; font-weight:700; font-size:.9rem; letter-spacing:.06em; }
    .month-day { background:#fff; padding:10px; min-height:110px; border:1px solid transparent; position:relative; display:flex; flex-direction:column; cursor:pointer; }
    .month-day.other-month { background:#f8f9fa; color:var(--text-secondary); cursor:default; }
    .month-day.has-activity { border-left:5px solid var(--primary-color); }
    .month-day.today { outline:3px solid #FF1744; outline-offset:-3px; border-radius:6px; }
    .day-number { font-size:1.1rem; font-weight:800; margin-bottom:6px; color:var(--text-primary); }
    .activity-tag { background: linear-gradient(135deg, var(--accent-color), var(--primary-color)); color:#fff;
      padding:4px 8px; border-radius:14px; font-size:.78rem; font-weight:700; align-self:flex-start; }

    /* Annuale */
    .year-grid { display:grid; grid-template-columns: repeat(4, 1fr); gap:20px; }
    @media (max-width: 1100px) { .year-grid { grid-template-columns: repeat(2, 1fr); } }
    @media (max-width: 560px)  { .year-grid { grid-template-columns: 1fr; } }
    .mini-month {
      background:#fff; border-radius: var(--border-radius); box-shadow: var(--shadow-light);
      padding:16px; display:flex; flex-direction:column; min-height:320px;
      transition:var(--transition); overflow:hidden;
    }
    .mini-month:hover { transform: translateY(-4px); box-shadow: var(--shadow-medium); }
    .mini-month-header { text-align:center; font-size:1.15rem; font-weight:800; color:var(--text-primary);
      margin-bottom:10px; padding-bottom:8px; border-bottom:2px solid var(--light-color); }
    .mini-month-grid {
      display:grid; grid-template-columns: repeat(7, 1fr);
      grid-auto-rows: 1fr; gap:4px; flex:1 1 auto; min-height: 0;
    }
    .mini-dow { font-size:.7rem; font-weight:700; text-align:center; color:#7f8c8d; padding:4px 0; }
    .mini-day {
      background:#fff; border-radius:8px; display:flex; align-items:center; justify-content:center;
      font-size:.9rem; color:var(--text-primary); border:1px solid #eef2f7; min-height:32px;
      transition:var(--transition); cursor:pointer;
    }
    .mini-day.muted { background:#f8f9fb; color:#b6c0c8; cursor:default; }
    .mini-day.has-activity { background: var(--primary-color); color:#fff; font-weight:700; flex-direction:column; line-height:1.1; }
    .mini-day.today { outline:2px solid #FF1744; outline-offset:-2px; border-radius:8px; }
    .mini-activity-text { font-size:.62rem; margin-top:2px; }

    /* Info/Legenda/Foot */
    .info-panel { margin-top:28px; display:grid; grid-template-columns: 2fr 1fr; gap:20px; }
    @media (max-width: 1000px){ .info-panel { grid-template-columns:1fr; } }
    .legend-section, .activity-details { background: rgba(255,255,255,0.92); border-radius: var(--border-radius); padding:20px; box-shadow: var(--shadow-light); }
    .legend-title { font-size:1.2rem; font-weight:800; margin-bottom:12px; display:flex; align-items:center; gap:8px; }
    .legend-grid { display:grid; grid-template-columns: repeat(auto-fit, minmax(140px, 1fr)); gap:12px; }
    .legend-item { display:flex; align-items:center; gap:10px; padding:8px; background:#fff; border-radius:8px; box-shadow: 0 2px 5px rgba(0,0,0,0.05); }
    .legend-color { width:18px; height:18px; border-radius:50%; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
    .activity-summary { background: linear-gradient(135deg, var(--accent-color), var(--success-color));
      color:#fff; padding:16px; border-radius:10px; margin-bottom:12px; }
      
    .button-container {
        display: flex;
        flex-wrap: wrap;
        gap: 10px;
        margin-top: 15px;
        justify-content: center;
    }

    .action-button {
      background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
      border: none;
      color: white;
      padding: 10px 20px;
      font-size: 0.9rem;
      font-weight: 700;
      border-radius: 20px;
      cursor: pointer;
      box-shadow: 0 4px 10px rgba(0,0,0,0.15);
      transition: all 0.3s ease;
      text-decoration: none;
      display: inline-flex;
      align-items: center;
      gap: 8px;
    }
    
    .action-button.print { background: linear-gradient(135deg, #ff6b6b 0%, #d64a4a 100%); }
    .action-button.google-calendar { background: #4285F4; }
    .action-button.export-month { background: #E91E63; }
    .action-button.export-year { background: #673AB7; }
    .action-button.export-week { background: #FF9800; }

    .action-button:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 15px rgba(0,0,0,0.2);
    }
    
    .school-footer {
      background: linear-gradient(135deg, var(--dark-color), #34495e);
      color:#fff; text-align:center; padding:24px 16px; margin-top:32px; border-radius:24px 24px 0 0; box-shadow: var(--shadow-heavy);
    }
    .footer-title { font-size:1.05rem; font-weight:700; color:#FFD700; margin-bottom:6px; }
    .footer-address { font-size:.95rem; opacity:.9; }

    @keyframes fadeIn { from {opacity:0;} to {opacity:1;} }
  </style>
</head>
<body>
  <div class="main-container">
    <div class="dashboard-header">
      <h1 class="dashboard-title">üìö Calendario PCTO</h1>
      <p class="dashboard-subtitle">Piano Percorsi Competenze Trasversali e Orientamento 2025-2026</p>
    </div>

    <div class="calendar-container">
      <div class="tabs-container">
        <button class="tab active" onclick="showTab(event,'monthly')">üìÖ Vista Mensile</button>
        <button class="tab" onclick="showTab(event,'weekly')">üìä Vista Settimanale</button>
        <button class="tab" onclick="showTab(event,'annual')">üóìÔ∏è Vista Annuale</button>
      </div>

      <div class="calendar-content">
        <div id="monthly" class="content-section active">
          <div class="month-header">
            <div class="nav-buttons-group">
                <button class="nav-button" onclick="previousMonth()">‚Äπ</button>
                <div class="current-period" id="monthTitle">Settembre 2025</div>
                <button class="nav-button" onclick="nextMonth()">‚Ä∫</button>
            </div>
            <button class="action-button export-month" onclick="exportCalendarToIcs('month')">
              <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-download"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path><polyline points="7 10 12 15 17 10"></polyline><line x1="12" y1="15" x2="12" y2="3"></line></svg>
              Esporta il mese
            </button>
          </div>
          <div class="month-grid" id="monthGrid"></div>
        </div>

        <div id="weekly" class="content-section">
          <div class="month-header">
            <button class="nav-button" onclick="previousWeek()">‚Äπ</button>
            <div class="current-period" id="weekTitle">Settimana 1 - Settembre 2025</div>
            <button class="nav-button" onclick="nextWeek()">‚Ä∫</button>
          </div>
          <div class="week-grid" id="weekGrid"></div>
          <div style="text-align: center; margin-top: 20px;">
            <button class="action-button export-week" onclick="exportCalendarToIcs('week')">
              <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-download"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path><polyline points="7 10 12 15 17 10"></polyline><line x1="12" y1="15" x2="12" y2="3"></line></svg>
              Esporta la settimana
            </button>
          </div>
        </div>

        <div id="annual" class="content-section">
          <div class="current-period" style="text-align:center; margin-bottom:18px;">Anno Scolastico 2025-2026</div>
          <div class="year-grid" id="yearGrid"></div>
          <div style="text-align: center; margin-top: 20px;">
            <button class="action-button export-year" onclick="exportCalendarToIcs('year')">
              <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-download"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path><polyline points="7 10 12 15 17 10"></polyline><line x1="12" y1="15" x2="12" y2="3"></line></svg>
              Esporta l'anno
            </button>
          </div>
        </div>
      </div>
    </div>

    <div class="info-panel">
      <div class="legend-section">
        <div class="legend-title">üéØ Legenda Attivit√† PCTO</div>
        <div class="legend-grid" id="legendContainer"></div>
        <div style="text-align: center; margin-top: 20px;">
          <button class="action-button print" onclick="window.print()">
            üñ®Ô∏è Stampa
          </button>
        </div>
      </div>
      <div class="activity-details">
        <div class="activity-summary">
          <h4>üìã Attivit√† Corrente</h4>
          <p id="currentActivity">Nessuna attivit√† selezionata</p>
        </div>
        <div id="activityInfo">
          <p>Seleziona una data nel calendario per visualizzare i dettagli delle attivit√† PCTO programmate.</p>
        </div>
        <div id="calendarButtons" class="button-container">
          </div>
      </div>
    </div>

    <div class="school-footer">
      <div class="footer-title">Pagina creata dal Team Buone Pratiche dell'IIS MENDEL</div>
      <div class="footer-address">Via Ferrazzi 15 - 20035 Villa Cortese (MI)</div>
    </div>

    <div id="instructions" style="background:#fff; border-radius:16px; padding:20px; margin-top:20px; box-shadow:var(--shadow-light);">
      <h3>Guida per l'importazione su Google Calendar</h3>
      <p>Il calendario offre 3 opzioni per sincronizzare le attivit√†:</p>
      <ol>
        <li>
          <strong>Esportare una singola attivit√†:</strong> Clicca su un giorno del calendario con un evento. Apparir√† un pulsante che ti permetter√† di aggiungere quell'attivit√† specifica al tuo calendario in un solo passaggio.
        </li>
        <li>
          <strong>Esportare il mese o l'anno intero:</strong> Clicca sul pulsante "Esporta il mese" o "Esporta l'anno" nella vista corrispondente. Verr√† scaricato un file in formato `.ics`.
        </li>
      </ol>
      <p>
        <strong>Come importare un file .ics su Google Calendar:</strong>
        <ol>
          <li>Dopo aver scaricato il file, si aprir√† una nuova scheda che ti reindirizza alla pagina di importazione di Google Calendar.</li>
          <li>In quella pagina, clicca su **"Seleziona un file dal computer"** e scegli il file .ics appena scaricato.</li>
          <li>Scegli in quale tuo calendario vuoi importare gli eventi e clicca su **"Importa"**.</li>
        </ol>
      </p>
    </div>
  </div>

  <script>
    const pctoData = {
      "2025-08": { 28: { day: "G", activity: "Oggi", type: "OGGI", description: "Data odierna - 28 Agosto 2025" } },
      "2025-09": {
        1: { day: "L", activity: "Inizio attivit√† ordinaria", type: "LEZIONI", description: "Avvio delle attivit√† didattiche per l'anno scolastico 2025-2026" },
        12: { day: "V", activity: "INIZIO LEZIONI", type: "LEZIONI", description: "Primo giorno ufficiale di lezione" },
        15: { day: "L", activity: "4PA", type: "4PA", description: "Attivit√† PCTO per la classe 4PA" },
        16: { day: "M", activity: "4PA", type: "4PA", description: "Attivit√† PCTO per la classe 4PA" },
        17: { day: "M", activity: "4PA", type: "4PA", description: "Attivit√† PCTO per la classe 4PA" },
        18: { day: "G", activity: "4PA", type: "4PA", description: "Attivit√† PCTO per la classe 4PA" },
        19: { day: "V", activity: "4PA", type: "4PA", description: "Attivit√† PCTO per la classe 4PA" },
        20: { day: "S", activity: "4PA", type: "4PA", description: "Attivit√† PCTO per la classe 4PA" },
        22: { day: "L", activity: "4PB", type: "4PB", description: "Attivit√† PCTO per la classe 4PB" },
        23: { day: "M", activity: "4PB", type: "4PB", description: "Attivit√† PCTO per la classe 4PB" },
        24: { day: "M", activity: "4PB", type: "4PB", description: "Attivit√† PCTO per la classe 4PB" },
        25: { day: "G", activity: "4PB", type: "4PB", description: "Attivit√† PCTO per la classe 4PB" },
        26: { day: "V", activity: "4PB", type: "4PB", description: "Attivit√† PCTO per la classe 4PB" },
        27: { day: "S", activity: "4PB", type: "4PB", description: "Attivit√† PCTO per la classe 4PB" },
        29: { day: "L", activity: "3PA", type: "3PA", description: "Attivit√† PCTO per la classe 3PA" },
        30: { day: "M", activity: "3PA", type: "3PA", description: "Attivit√† PCTO per la classe 3PA" }
      },
      "2025-10": {
        1: { day: "M", activity: "3PA", type: "3PA", description: "Attivit√† PCTO per la classe 3PA" },
        2: { day: "G", activity: "3PA", type: "3PA", description: "Attivit√† PCTO per la classe 3PA" },
        3: { day: "V", activity: "3PA", type: "3PA", description: "Attivit√† PCTO per la classe 3PA" },
        6: { day: "L", activity: "3PB", type: "3PB", description: "Attivit√† PCTO per la classe 3PB" },
        7: { day: "M", activity: "3PB", type: "3PB", description: "Attivit√† PCTO per la classe 3PB" },
        8: { day: "M", activity: "3PB", type: "3PB", description: "Attivit√† PCTO per la classe 3PB" },
        9: { day: "G", activity: "3PB", type: "3PB", description: "Attivit√† PCTO per la classe 3PB" },
        10: { day: "V", activity: "3PB", type: "3PB", description: "Attivit√† PCTO per la classe 3PB" },
        13: { day: "L", activity: "3PC", type: "3PC", description: "Attivit√† PCTO per la classe 3PC" },
        14: { day: "M", activity: "3PC", type: "3PC", description: "Attivit√† PCTO per la classe 3PC" },
        15: { day: "M", activity: "3PC", type: "3PC", description: "Attivit√† PCTO per la classe 3PC" },
        16: { day: "G", activity: "3PC", type: "3PC", description: "Attivit√† PCTO per la classe 3PC" },
        17: { day: "V", activity: "3PC", type: "3PC", description: "Attivit√† PCTO per la classe 3PC" },
        20: { day: "L", activity: "4A", type: "4A", description: "Attivit√† PCTO per la classe 4A" },
        21: { day: "M", activity: "4A", type: "4A", description: "Attivit√† PCTO per la classe 4A" },
        22: { day: "M", activity: "4A", type: "4A", description: "Attivit√† PCTO per la classe 4A" },
        23: { day: "G", activity: "4A", type: "4A", description: "Attivit√† PCTO per la classe 4A" },
        24: { day: "V", activity: "4A", type: "4A", description: "Attivit√† PCTO per la classe 4A" },
        27: { day: "L", activity: "4B", type: "4B", description: "Attivit√† PCTO per la classe 4B" },
        28: { day: "M", activity: "4B", type: "4B", description: "Attivit√† PCTO per la classe 4B" },
        29: { day: "M", activity: "4B", type: "4B", description: "Attivit√† PCTO per la classe 4B" },
        30: { day: "G", activity: "4B", type: "4B", description: "Attivit√† PCTO per la classe 4B" },
        31: { day: "V", activity: "SOSPENSIONE DIDATTICA", type: "SOSPENSIONE", description: "Sospensione delle attivit√† didattiche" }
      },
      "2025-11": {
        1: { day: "S", activity: "Ognissanti", type: "FESTIVIT√Ä", description: "Festa di Ognissanti" },
        3: { day: "L", activity: "4C", type: "4C", description: "Attivit√† PCTO per la classe 4C" },
        4: { day: "M", activity: "4C", type: "4C", description: "Attivit√† PCTO per la classe 4C" },
        5: { day: "M", activity: "4C", type: "4C", description: "Attivit√† PCTO per la classe 4C" },
        6: { day: "G", activity: "4C", type: "4C", description: "Attivit√† PCTO per la classe 4C" },
        7: { day: "V", activity: "4C", type: "4C", description: "Attivit√† PCTO per la classe 4C" },
        10: { day: "L", activity: "4D", type: "4D", description: "Attivit√† PCTO per la classe 4D" },
        11: { day: "M", activity: "4D", type: "4D", description: "Attivit√† PCTO per la classe 4D" },
        12: { day: "M", activity: "4D", type: "4D", description: "Attivit√† PCTO per la classe 4D" },
        13: { day: "G", activity: "4D", type: "4D", description: "Attivit√† PCTO per la classe 4D" },
        14: { day: "V", activity: "4D", type: "4D", description: "Attivit√† PCTO per la classe 4D" },
        17: { day: "L", activity: "4PA", type: "4PA", description: "Attivit√† PCTO per la classe 4PA" },
        18: { day: "M", activity: "4PA", type: "4PA", description: "Attivit√† PCTO per la classe 4PA" },
        19: { day: "M", activity: "4PA", type: "4PA", description: "Attivit√† PCTO per la classe 4PA" },
        20: { day: "G", activity: "4PA", type: "4PA", description: "Attivit√† PCTO per la classe 4PA" },
        21: { day: "V", activity: "4PA", type: "4PA", description: "Attivit√† PCTO per la classe 4PA" },
        22: { day: "S", activity: "SOSPENSIONE DIDATTICA", type: "SOSPENSIONE", description: "Sospensione delle attivit√† didattiche" },
        24: { day: "L", activity: "4PB", type: "4PB", description: "Attivit√† PCTO per la classe 4PB" },
        25: { day: "M", activity: "4PB", type: "4PB", description: "Attivit√† PCTO per la classe 4PB" },
        26: { day: "M", activity: "4PB", type: "4PB", description: "Attivit√† PCTO per la classe 4PB" },
        27: { day: "G", activity: "4PB", type: "4PB", description: "Attivit√† PCTO per la classe 4PB" },
        28: { day: "V", activity: "4PB", type: "4PB", description: "Attivit√† PCTO per la classe 4PB" },
        29: { day: "S", activity: "4PB", type: "4PB", description: "Attivit√† PCTO per la classe 4PB" },
        30: { day: "D", activity: "4PB", type: "4PB", description: "Attivit√† PCTO per la classe 4PB" }
      },
      "2025-12": {
        1: { day: "L", activity: "3PA", type: "3PA", description: "Attivit√† PCTO per la classe 3PA" },
        2: { day: "M", activity: "3PA", type: "3PA", description: "Attivit√† PCTO per la classe 3PA" },
        3: { day: "M", activity: "3PA", type: "3PA", description: "Attivit√† PCTO per la classe 3PA" },
        4: { day: "G", activity: "3PA", type: "3PA", description: "Attivit√† PCTO per la classe 3PA" },
        5: { day: "V", activity: "3PA", type: "3PA", description: "Attivit√† PCTO per la classe 3PA" },
        8: { day: "L", activity: "Immacolata", type: "FESTIVIT√Ä", description: "Immacolata Concezione" },
        9: { day: "M", activity: "3PB", type: "3PB", description: "Attivit√† PCTO per la classe 3PB" },
        10: { day: "M", activity: "3PB", type: "3PB", description: "Attivit√† PCTO per la classe 3PB" },
        11: { day: "G", activity: "3PB", type: "3PB", description: "Attivit√† PCTO per la classe 3PB" },
        12: { day: "V", activity: "3PB", type: "3PB", description: "Attivit√† PCTO per la classe 3PB" },
        15: { day: "L", activity: "3PC", type: "3PC", description: "Attivit√† PCTO per la classe 3PC" },
        16: { day: "M", activity: "3PC", type: "3PC", description: "Attivit√† PCTO per la classe 3PC" },
        17: { day: "M", activity: "3PC", type: "3PC", description: "Attivit√† PCTO per la classe 3PC" },
        18: { day: "G", activity: "3PC", type: "3PC", description: "Attivit√† PCTO per la classe 3PC" },
        19: { day: "V", activity: "3PC", type: "3PC", description: "Attivit√† PCTO per la classe 3PC" },
        23: { day: "M", activity: "Inizio vacanze di Natale", type: "VACANZE", description: "Inizio delle vacanze natalizie" },
        25: { day: "G", activity: "SS. Natale", type: "FESTIVIT√Ä", description: "Santo Natale" },
        26: { day: "V", activity: "S. Stefano", type: "FESTIVIT√Ä", description: "Santo Stefano" }
      },
      "2026-01": {
        6: { day: "M", activity: "Fine Vac. Natalizie", type: "LEZIONI", description: "Fine delle vacanze natalizie" },
        7: { day: "M", activity: "SOSPENSIONE PCTO", type: "SOSPENSIONE", description: "Sospensione attivit√† PCTO" },
        9: { day: "V", activity: "3A", type: "3A", description: "Attivit√† PCTO per la classe 3A" },
        10: { day: "S", activity: "3A", type: "3A", description: "Attivit√† PCTO per la classe 3A" },
        12: { day: "L", activity: "3B", type: "3B", description: "Attivit√† PCTO per la classe 3B" },
        13: { day: "M", activity: "3B", type: "3B", description: "Attivit√† PCTO per la classe 3B" },
        14: { day: "M", activity: "3B", type: "3B", description: "Attivit√† PCTO per la classe 3B" },
        15: { day: "G", activity: "3B", type: "3B", description: "Attivit√† PCTO per la classe 3B" },
        16: { day: "V", activity: "FINE 1Q", type: "LEZIONI", description: "Fine del primo quadrimestre" },
        19: { day: "L", activity: "2PA", type: "2PA", description: "Attivit√† PCTO per la classe 2PA" },
        20: { day: "M", activity: "2PA", type: "2PA", description: "Attivit√† PCTO per la classe 2PA" },
        21: { day: "M", activity: "2PA", type: "2PA", description: "Attivit√† PCTO per la classe 2PA" },
        22: { day: "G", activity: "2PA", type: "2PA", description: "Attivit√† PCTO per la classe 2PA" },
        23: { day: "V", activity: "2PA", type: "2PA", description: "Attivit√† PCTO per la classe 2PA" },
        26: { day: "L", activity: "2PB", type: "2PB", description: "Attivit√† PCTO per la classe 2PB" },
        27: { day: "M", activity: "2PB", type: "2PB", description: "Attivit√† PCTO per la classe 2PB" },
        28: { day: "M", activity: "2PB", type: "2PB", description: "Attivit√† PCTO per la classe 2PB" },
        29: { day: "G", activity: "2PB", type: "2PB", description: "Attivit√† PCTO per la classe 2PB" },
        30: { day: "V", activity: "2PB", type: "2PB", description: "Attivit√† PCTO per la classe 2PB" }
      },
      "2026-02": {
        2: { day: "L", activity: "3A", type: "3A", description: "Attivit√† PCTO per la classe 3A" },
        3: { day: "M", activity: "3A", type: "3A", description: "Attivit√† PCTO per la classe 3A" },
        4: { day: "M", activity: "3A", type: "3A", description: "Attivit√† PCTO per la classe 3A" },
        5: { day: "G", activity: "3A", type: "3A", description: "Attivit√† PCTO per la classe 3A" },
        6: { day: "V", activity: "3A", type: "3A", description: "Attivit√† PCTO per la classe 3A" },
        16: { day: "L", activity: "3C", type: "3C", description: "Attivit√† PCTO per la classe 3C" },
        17: { day: "M", activity: "3C", type: "3C", description: "Attivit√† PCTO per la classe 3C" },
        18: { day: "M", activity: "3C", type: "3C", description: "Attivit√† PCTO per la classe 3C" },
        19: { day: "G", activity: "3C", type: "3C", description: "Attivit√† PCTO per la classe 3C" },
        20: { day: "V", activity: "CARNEVALE", type: "FESTIVIT√Ä", description: "Carnevale" },
        21: { day: "S", activity: "CARNEVALE", type: "FESTIVIT√Ä", description: "Carnevale" },
        23: { day: "L", activity: "3D", type: "3D", description: "Attivit√† PCTO per la classe 3D" },
        24: { day: "M", activity: "3D", type: "3D", description: "Attivit√† PCTO per la classe 3D" },
        25: { day: "M", activity: "3D", type: "3D", description: "Attivit√† PCTO per la classe 3D" },
        26: { day: "G", activity: "3D", type: "3D", description: "Attivit√† PCTO per la classe 3D" },
        27: { day: "V", activity: "3D", type: "3D", description: "Attivit√† PCTO per la classe 3D" }
      },
      "2026-03": {
        2: { day: "L", activity: "4PA", type: "4PA", description: "Attivit√† PCTO per la classe 4PA" },
        3: { day: "M", activity: "4PA", type: "4PA", description: "Attivit√† PCTO per la classe 4PA" },
        4: { day: "M", activity: "4PA", type: "4PA", description: "Attivit√† PCTO per la classe 4PA" },
        5: { day: "G", activity: "4PA", type: "4PA", description: "Attivit√† PCTO per la classe 4PA" },
        6: { day: "V", activity: "4PA", type: "4PA", description: "Attivit√† PCTO per la classe 4PA" },
        9: { day: "L", activity: "4PB", type: "4PB", description: "Attivit√† PCTO per la classe 4PB" },
        10: { day: "M", activity: "4PB", type: "4PB", description: "Attivit√† PCTO per la classe 4PB" },
        11: { day: "M", activity: "4PB", type: "4PB", description: "Attivit√† PCTO per la classe 4PB" },
        12: { day: "G", activity: "4PB", type: "4PB", description: "Attivit√† PCTO per la classe 4PB" },
        13: { day: "V", activity: "4PB", type: "4PB", description: "Attivit√† PCTO per la classe 4PB" },
        16: { day: "L", activity: "3PA", type: "3PA", description: "Attivit√† PCTO per la classe 3PA" },
        17: { day: "M", activity: "3PA", type: "3PA", description: "Attivit√† PCTO per la classe 3PA" },
        18: { day: "M", activity: "3PA", type: "3PA", description: "Attivit√† PCTO per la classe 3PA" },
        19: { day: "G", activity: "3PA", type: "3PA", description: "Attivit√† PCTO per la classe 3PA" },
        20: { day: "V", activity: "3PA", type: "3PA", description: "Attivit√† PCTO per la classe 3PA" },
        23: { day: "L", activity: "3PB", type: "3PB", description: "Attivit√† PCTO per la classe 3PB" },
        24: { day: "M", activity: "3PB", type: "3PB", description: "Attivit√† PCTO per la classe 3PB" },
        25: { day: "M", activity: "3PB", type: "3PB", description: "Attivit√† PCTO per la classe 3PB" },
        26: { day: "G", activity: "3PB", type: "3PB", description: "Attivit√† PCTO per la classe 3PB" },
        27: { day: "V", activity: "3PB", type: "3PB", description: "Attivit√† PCTO per la classe 3PB" },
        30: { day: "L", activity: "3PC", type: "3PC", description: "Attivit√† PCTO per la classe 3PC" },
        31: { day: "M", activity: "3PC", type: "3PC", description: "Attivit√† PCTO per la classe 3PC" }
      },
      "2026-04": {
        1: { day: "M", activity: "3PC", type: "3PC", description: "Attivit√† PCTO per la classe 3PC" },
        2: { day: "G", activity: "VAC. PASQUALI", type: "VACANZE", description: "Vacanze pasquali" },
        3: { day: "V", activity: "VAC. PASQUALI", type: "VACANZE", description: "Vacanze pasquali" },
        4: { day: "S", activity: "VAC. PASQUALI", type: "VACANZE", description: "Vacanze pasquali" },
        6: { day: "L", activity: "VAC. PASQUALI", type: "VACANZE", description: "Vacanze pasquali" },
        7: { day: "M", activity: "VAC. PASQUALI", type: "VACANZE", description: "Vacanze pasquali" },
        8: { day: "M", activity: "3PC", type: "3PC", description: "Attivit√† PCTO per la classe 3PC" },
        9: { day: "G", activity: "3PC", type: "3PC", description: "Attivit√† PCTO per la classe 3PC" },
        10: { day: "V", activity: "3PC", type: "3PC", description: "Attivit√† PCTO per la classe 3PC" },
        13: { day: "L", activity: "3A", type: "3A", description: "Attivit√† PCTO per la classe 3A" },
        14: { day: "M", activity: "3A", type: "3A", description: "Attivit√† PCTO per la classe 3A" },
        15: { day: "M", activity: "3A", type: "3A", description: "Attivit√† PCTO per la classe 3A" },
        16: { day: "G", activity: "3A", type: "3A", description: "Attivit√† PCTO per la classe 3A" },
        17: { day: "V", activity: "3A", type: "3A", description: "Attivit√† PCTO per la classe 3A" },
        20: { day: "L", activity: "3B", type: "3B", description: "Attivit√† PCTO per la classe 3B" },
        21: { day: "M", activity: "3B", type: "3B", description: "Attivit√† PCTO per la classe 3B" },
        22: { day: "M", activity: "3B", type: "3B", description: "Attivit√† PCTO per la classe 3B" },
        23: { day: "G", activity: "3B", type: "3B", description: "Attivit√† PCTO per la classe 3B" },
        24: { day: "V", activity: "3B", type: "3B", description: "Attivit√† PCTO per la classe 3B" },
        25: { day: "S", activity: "FESTA LIBERAZIONE", type: "FESTIVIT√Ä", description: "Festa della Liberazione" },
        27: { day: "L", activity: "3C", type: "3C", description: "Attivit√† PCTO per la classe 3C" },
        28: { day: "M", activity: "3C", type: "3C", description: "Attivit√† PCTO per la classe 3C" },
        29: { day: "M", activity: "3C", type: "3C", description: "Attivit√† PCTO per la classe 3C" },
        30: { day: "G", activity: "3C", type: "3C", description: "Attivit√† PCTO per la classe 3C" }
      },
      "2026-05": {
        1: { day: "V", activity: "F. Lavoratori", type: "FESTIVIT√Ä", description: "Festa dei Lavoratori" },
        4: { day: "L", activity: "3D", type: "3D", description: "Attivit√† PCTO per la classe 3D" },
        5: { day: "M", activity: "3D", type: "3D", description: "Attivit√† PCTO per la classe 3D" },
        6: { day: "M", activity: "3D", type: "3D", description: "Attivit√† PCTO per la classe 3D" },
        7: { day: "G", activity: "3D", type: "3D", description: "Attivit√† PCTO per la classe 3D" },
        8: { day: "V", activity: "3D", type: "3D", description: "Attivit√† PCTO per la classe 3D" },
        11: { day: "L", activity: "2PA", type: "2PA", description: "Attivit√† PCTO per la classe 2PA" },
        12: { day: "M", activity: "2PA", type: "2PA", description: "Attivit√† PCTO per la classe 2PA" },
        13: { day: "M", activity: "2PA", type: "2PA", description: "Attivit√† PCTO per la classe 2PA" },
        14: { day: "G", activity: "2PA", type: "2PA", description: "Attivit√† PCTO per la classe 2PA" },
        15: { day: "V", activity: "2PA", type: "2PA", description: "Attivit√† PCTO per la classe 2PA" },
        18: { day: "L", activity: "2PB", type: "2PB", description: "Attivit√† PCTO per la classe 2PB" },
        19: { day: "M", activity: "2PB", type: "2PB", description: "Attivit√† PCTO per la classe 2PB" },
        20: { day: "M", activity: "2PB", type: "2PB", description: "Attivit√† PCTO per la classe 2PB" },
        21: { day: "G", activity: "2PB", type: "2PB", description: "Attivit√† PCTO per la classe 2PB" },
        22: { day: "V", activity: "2PB", type: "2PB", description: "Attivit√† PCTO per la classe 2PB" },
        25: { day: "L", activity: "SOSPENSIONE DIDATTICA", type: "SOSPENSIONE", description: "Sospensione delle attivit√† didattiche" },
        26: { day: "M", activity: "2PA", type: "2PA", description: "Attivit√† PCTO per la classe 2PA" },
        27: { day: "M", activity: "2PA", type: "2PA", description: "Attivit√† PCTO per la classe 2PA" },
        28: { day: "G", activity: "2PA", type: "2PA", description: "Attivit√† PCTO per la classe 2PA" },
        29: { day: "V", activity: "2PA", type: "2PA", description: "Attivit√† PCTO per la classe 2PA" }
      },
      "2026-06": {
        1: { day: "L", activity: "SOSPENSIONE", type: "SOSPENSIONE", description: "Sospensione didattica" },
        2: { day: "M", activity: "F. Repubblica", type: "FESTIVIT√Ä", description: "Festa della Repubblica" },
        8: { day: "L", activity: "TERMINE DELLE LEZIONI", type: "LEZIONI", description: "Fine dell'anno scolastico" },
        9: { day: "M", activity: "INIZIO PCTO ESTIVO", type: "PCTO_ESTIVO", description: "Inizio attivit√† PCTO estive" },
        17: { day: "M", activity: "INIZIO ESAMI STATO", type: "ESAMI", description: "Inizio Esami di Stato" }
      }
    };
    
    const activityColors = {
      "3PA": "#FF6B6B","4PA": "#4ECDC4","3PB": "#45B7D1","4PB": "#96CEB4","3PC": "#FECA57","4PC": "#FF9FF3",
      "2PA": "#54A0FF","2PB": "#5F27CD","3A": "#00D2D3","3B": "#FF9F43","3C": "#10AC84","3D": "#EE5A24",
      "4A": "#0984E3","4B": "#6C5CE7","4C": "#A29BFE","4D": "#FD79A8",
      "VACANZE": "#E17055","FESTIVIT√Ä": "#FDCB6E","SOSPENSIONE": "#BDC3C7","LEZIONI": "#00B894","OGGI": "#FF1744",
      "PCTO_ESTIVO": "#9C27B0","ESAMI": "#FF5722"
    };

    const months = ["Gennaio","Febbraio","Marzo","Aprile","Maggio","Giugno","Luglio","Agosto","Settembre","Ottobre","Novembre","Dicembre"];
    const shortDays = ["Dom","Lun","Mar","Mer","Gio","Ven","Sab"];
    let currentMonth = 8;
    let currentYear = 2025;
    let currentWeek = 0;
    let currentSelectedDayData = null;

    function showTab(ev, name){
      document.querySelectorAll('.content-section').forEach(s => s.classList.remove('active'));
      document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
      document.getElementById(name).classList.add('active');
      ev.target.classList.add('active');
      if(name==='monthly') generateMonthlyView();
      if(name==='weekly')  generateWeeklyView();
      if(name==='annual')  generateAnnualView();
    }

    function todayInfo(){
      const now = new Date();
      return { y: now.getFullYear(), m: now.getMonth(), d: now.getDate() };
    }

    function generateMonthlyView(){
      const monthKey = `${currentYear}-${String(currentMonth+1).padStart(2,'0')}`;
      const first = new Date(currentYear, currentMonth, 1);
      const last  = new Date(currentYear, currentMonth+1, 0);
      const daysInMonth = last.getDate();
      const startDow = first.getDay();

      document.getElementById('monthTitle').textContent = `${months[currentMonth]} ${currentYear}`;
      let html = '';
      shortDays.forEach(d => html += `<div class="month-day-header">${d}</div>`);
      for(let i=0;i<startDow;i++){ html += `<div class="month-day other-month"></div>`; }
      const t = todayInfo();
      for(let d=1; d<=daysInMonth; d++){
        const data = pctoData[monthKey] && pctoData[monthKey][d];
        const has = data ? 'has-activity' : '';
        const isToday = (currentYear===t.y && currentMonth===t.m && d===t.d) ? 'today' : '';
        const color = data ? (activityColors[data.type]||'#667eea') : null;
        html += `<div class="month-day ${has} ${isToday}" onclick="selectDay('${monthKey}', ${d})">`+
                  `<div class="day-number">${d}</div>`+
                  (data ? `<div class="activity-tag" style="background:${color}">${data.type}</div>` : ``)+
                `</div>`;
      }
      document.getElementById('monthGrid').innerHTML = html;
    }

    function generateWeeklyView(){
      const start = new Date(currentYear, currentMonth, 1 + currentWeek*7);
      const title = `Settimana ${currentWeek+1} - ${months[currentMonth]} ${currentYear}`;
      document.getElementById('weekTitle').textContent = title;
      let html = '<div style="padding:12px; color:#7f8c8d;">Vista settimanale in preparazione.</div>';
      document.getElementById('weekGrid').innerHTML = html;
    }

    function generateAnnualView(){
      const yearGrid = document.getElementById('yearGrid');
      let html = '';
      for(let m=8;m<12;m++){ html += miniMonthHTML(m, 2025); }
      for(let m=0;m<6;m++){ html += miniMonthHTML(m, 2026); }
      yearGrid.innerHTML = html;
    }

    function miniMonthHTML(month, year){
      const monthKey = `${year}-${String(month+1).padStart(2,'0')}`;
      const first = new Date(year, month, 1);
      const last  = new Date(year, month+1, 0);
      const daysInMonth = last.getDate();
      const startDow = first.getDay();
      const t = todayInfo();
      const isCurrent = (year===t.y && month===t.m);
      let html = `<div class="mini-month"><div class="mini-month-header">${months[month]} ${year}</div><div class="mini-month-grid">`;
      shortDays.forEach(d => html += `<div class="mini-dow">${d[0]}</div>`);
      for(let i=0;i<startDow;i++){ html += `<div class="mini-day muted"></div>`; }
      let filled = startDow;
      for(let d=1; d<=daysInMonth; d++){
        const data = pctoData[monthKey] && pctoData[monthKey][d];
        const has = data ? 'has-activity' : '';
        const isToday = (isCurrent && d===t.d) ? 'today' : '';
        const color = data ? (activityColors[data.type]||'#667eea') : null;
        html += `<div class="mini-day ${has} ${isToday}" ${color?`style="background:${color}"`:''} title="${data?data.activity:''}" onclick="selectDay('${monthKey}',${d})">`+
                  `${d}${data ? `<div class="mini-activity-text">${data.type}</div>` : ``}`+
                `</div>`;
        filled++;
      }
      while(filled < 7*6){ html += `<div class="mini-day muted"></div>`; filled++; }
      html += `</div></div>`;
      return html;
    }

    function generateLegend(){
      const used = new Set();
      Object.values(pctoData).forEach(m => Object.values(m).forEach(d => d.type && used.add(d.type)));
      let html = '';
      used.forEach(type => {
        const col = activityColors[type] || '#667eea';
        html += `<div class="legend-item"><div class="legend-color" style="background:${col}"></div><span>${type}</span></div>`;
      });
      document.getElementById('legendContainer').innerHTML = html;
    }

    function previousMonth(){ if(currentMonth===0){ currentMonth=11; currentYear--; } else currentMonth--; generateMonthlyView(); }
    function nextMonth(){ if(currentMonth===11){ currentMonth=0; currentYear++; } else currentMonth++; generateMonthlyView(); }
    function previousWeek(){ currentWeek = Math.max(0, currentWeek-1); generateWeeklyView(); }
    function nextWeek(){ currentWeek = Math.min(3, currentWeek+1); generateWeeklyView(); }

    function selectDay(monthKey, day){
      const data = pctoData[monthKey] && pctoData[monthKey][day];
      const calendarButtonsDiv = document.getElementById('calendarButtons');
      
      if(data){
        document.getElementById('currentActivity').textContent = data.activity;
        document.getElementById('activityInfo').innerHTML = `<p><strong>Tipo:</strong> ${data.type}</p><p><strong>Giorno:</strong> ${data.day}</p><p><strong>Descrizione:</strong> ${data.description}</p>`;
        
        const date = new Date(monthKey.split('-')[0], monthKey.split('-')[1] - 1, day);
        const startDateString = `${date.getFullYear()}${String(date.getMonth() + 1).padStart(2, '0')}${String(date.getDate()).padStart(2, '0')}`;
        const endDateString = startDateString;
        
        const title = encodeURIComponent(data.activity);
        const details = encodeURIComponent(data.description);
        
        const googleCalendarUrl = `https://www.google.com/calendar/render?action=TEMPLATE&text=${title}&dates=${startDateString}/${endDateString}&details=${details}`;
        
        calendarButtonsDiv.innerHTML = `
          <a href="${googleCalendarUrl}" target="_blank" class="action-button google-calendar">
            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-calendar"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect><line x1="16" y1="2" x2="16" y2="6"></line><line x1="8" y1="2" x2="8" y2="6"></line><line x1="3" y1="10" x2="21" y2="10"></line></svg>
            Aggiungi attivit√† singola
          </a>
        `;
      } else {
        document.getElementById('currentActivity').textContent = 'Nessuna attivit√† programmata';
        document.getElementById('activityInfo').innerHTML = '<p>Seleziona una data nel calendario per visualizzare i dettagli delle attivit√† PCTO programmate.</p>';
        document.getElementById('calendarButtons').innerHTML = '';
      }
    }

    function exportCalendarToIcs(scope) {
        let eventsToExport = {};
        let filename;
        let exportAll = false;
        
        if (scope === 'month') {
            const monthKey = `${currentYear}-${String(currentMonth + 1).padStart(2, '0')}`;
            eventsToExport = pctoData[monthKey] || {};
            filename = `calendario-pcto-${months[currentMonth]}-${currentYear}.ics`;
        } else if (scope === 'year') {
            exportAll = true;
            filename = `calendario-pcto-anno-scolastico-${currentYear}-${currentYear + 1}.ics`;
        } else if (scope === 'week') {
            const weekStart = new Date(currentYear, currentMonth, 1 + (currentWeek * 7));
            const weekEnd = new Date(weekStart);
            weekEnd.setDate(weekStart.getDate() + 6);
            filename = `calendario-pcto-settimana-${currentWeek+1}-${months[currentMonth]}-${currentYear}.ics`;

            for (let i = 0; i < 7; i++) {
                const day = new Date(weekStart);
                day.setDate(weekStart.getDate() + i);
                const dayKey = `${day.getFullYear()}-${String(day.getMonth() + 1).padStart(2, '0')}`;
                const dayData = pctoData[dayKey] && pctoData[dayKey][day.getDate()];
                if (dayData) {
                    eventsToExport[day.getDate()] = dayData;
                }
            }
        }

        if (exportAll) {
            for (const monthKey in pctoData) {
                if (pctoData.hasOwnProperty(monthKey)) {
                    Object.assign(eventsToExport, pctoData[monthKey]);
                }
            }
        }

        if (Object.keys(eventsToExport).length === 0) {
            alert(`Nessun evento PCTO trovato per questo ${scope === 'month' ? 'mese' : scope === 'year' ? 'anno' : 'periodo'}.`);
            return;
        }

        let icsContent = `BEGIN:VCALENDAR\nVERSION:2.0\nPRODID:-//PCTO Calendar//NONSGML v1.0//EN\n`;

        for (const day in eventsToExport) {
            const event = eventsToExport[day];
            const eventDate = new Date(currentYear, currentMonth, parseInt(day));
            const monthKey = `${eventDate.getFullYear()}-${String(eventDate.getMonth() + 1).padStart(2, '0')}`;
            
            if (scope === 'year' && event.type) {
                const fullYear = monthKey.substring(0, 4);
                if (fullYear < 2025 || fullYear > 2026) continue;
            }

            if (event.type && event.type !== 'OGGI' && event.type !== 'LEZIONI') {
                const date = new Date(currentYear, currentMonth, parseInt(day));
                const isoDate = `${date.getFullYear()}${String(date.getMonth() + 1).padStart(2, '0')}${String(date.getDate()).padStart(2, '0')}`;
                
                icsContent += `BEGIN:VEVENT\n`;
                icsContent += `UID:${isoDate}-${event.activity}@iismendel.edu.it\n`;
                icsContent += `DTSTART;VALUE=DATE:${isoDate}\n`;
                icsContent += `DTEND;VALUE=DATE:${isoDate}\n`; // Same day events
                icsContent += `SUMMARY:PCTO - ${event.activity}\n`;
                icsContent += `DESCRIPTION:${event.description}\n`;
                icsContent += `END:VEVENT\n`;
            }
        }
        icsContent += `END:VCALENDAR`;

        const blob = new Blob([icsContent], { type: 'text/calendar;charset=utf-8' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = filename;
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        URL.revokeObjectURL(url);
        
        window.open('https://calendar.google.com/calendar/r/settings/export', '_blank');
        alert(`Il file "${filename}" √® stato scaricato. Ora importa il file in Google Calendar.`);
    }

    document.addEventListener('DOMContentLoaded', () => {
      generateMonthlyView();
      generateLegend();
    });
  </script>
</body>
</html>